{% extends "base.html" %}
{% load static %}

{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7f7f7; }
        .product-card:hover { box-shadow: 0 4px 30px rgba(0,0,0,0.1); }
        .discount-badge { background-color: #dc2626; }
    </style>
</head>

<body class="min-h-screen">

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

    <!-- HEADER -->
    <div class="flex justify-between items-center mb-6 border-b pb-3">
        <p class="text-gray-600">
            <span class="font-bold text-gray-800">{{ products|length }}</span> Products Found
        </p>

        <!-- Sorting (Optional - static for now) -->
        <div class="flex items-center space-x-2 text-sm">
            <label for="sort" class="text-gray-600">Sort By:</label>
            <select id="sort" class="border rounded-md p-1">
                <option value="">Default</option>
                <option value="">Price: Low ‚Üí High</option>
                <option value="">Price: High ‚Üí Low</option>
                <option value="">Name: A ‚Üí Z</option>
            </select>
        </div>
    </div>

    <!-- PRODUCT GRID -->
    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6">

        {% for p in products %}
        <div class="bg-white rounded-lg overflow-hidden shadow product-card transition">

            <!-- IMAGE -->
            <a href="{% url 'shop:product_detail' p.id %}">
                <div class="relative">
                    {% if p.first_image_url %}
                        <img src="{{ p.first_image_url }}" alt="{{ p.name }}" class="w-full h-72 object-cover">
                    {% else %}
                        <img src="{% static 'shop/no-image.png' %}" class="w-full h-72 object-cover">
                    {% endif %}

                    {% if p.discount > 0 %}
                    <div class="absolute top-2 left-2 text-white text-xs font-bold px-2 py-1 rounded-sm discount-badge">
                        SAVE {{ p.discount|floatformat:0 }}%
                    </div>
                    {% endif %}
                </div>
            </a>

            <!-- DETAILS -->
            <div class="p-4 text-center">

                <h3 class="text-sm font-medium uppercase text-gray-800 truncate">
                    {{ p.name }}
                </h3>

                <!-- PRICE -->
                <p class="mt-1 text-lg font-semibold text-red-600">
                    {{ p.selling_price }} EGP
                    {% if p.discount > 0 %}
                    <span class="ml-2 text-sm text-gray-400 line-through font-normal">
                        {{ p.purchase_price }} EGP
                    </span>
                    {% endif %}
                </p>

                <!-- COLOR + BRAND -->
                {% if p.color or p.vendor %}
                <p class="text-xs text-gray-500 mt-1">
                    {{ p.color }}{% if p.vendor %} / {{ p.vendor }}{% endif %}
                </p>
                {% endif %}

                <!-- OUT OF STOCK -->
                {% if not p.availability %}
                <span class="text-xs text-red-500 font-bold mt-1 block">
                    OUT OF STOCK
                </span>
                {% endif %}

                <!-- BUTTONS -->
                <div class="mt-3">
                    {% if user.is_authenticated %}
                        {% if p.variants.first %}
                        <a href="{% url 'shop:add_to_cart' p.variants.first.id %}"
                           class="block w-full bg-black text-white py-2 rounded text-sm hover:bg-gray-800">
                            Add to Cart üõí
                        </a>
                        {% endif %}

                        <a href="{% url 'shop:toggle_favorite' p.id %}"
                           class="block w-full border border-gray-300 py-2 rounded text-sm mt-2 hover:bg-red-50">
                            {% if p.id in favorite_ids %}‚ù§Ô∏è Remove from Favorites{% else %}ü§ç Add to Favorites{% endif %}
                        </a>
                    {% else %}
                        <a href="{% url 'shop:login' %}"
                           class="block w-full border py-2 rounded text-sm text-gray-600">
                            Login to Buy
                        </a>
                    {% endif %}
                </div>

            </div>
        </div>
        {% endfor %}
    </div>

</div>

</body>
</html>

{% endblock %}
