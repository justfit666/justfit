{% extends "base.html" %}
{% load static %}
{% block content %}

<div class="container my-5">

  <div class="row">
      <div class="col-md-6 text-center">
          <img id="variant-image" src="{{ product.first_image_url }}"
               class="img-fluid rounded shadow" style="max-height: 400px">
      </div>

      <div class="col-md-6">
          <h2 class="fw-bold">{{ product.name }}</h2>
          <h4 class="text-success" id="variant-price">${{ product.price }}</h4>
          <hr>

          <!-- SIZE SELECTOR -->
          <h5 class="mt-3">Select Size</h5>
          <div id="size-options">
              {% for s in sizes %}
                  <button class="btn btn-outline-primary m-1 size-btn"
                          data-size="{{ s }}">{{ s }}</button>
              {% endfor %}
          </div>

          <!-- COLOR SELECTOR -->
          <h5 class="mt-3">Select Color</h5>
          <div id="color-options">
              {% for c in colors %}
                  <button class="btn btn-outline-dark m-1 color-btn"
                          data-color="{{ c }}">{{ c }}</button>
              {% endfor %}
          </div>

          <hr>

          <button class="btn btn-success btn-lg mt-3">Add to Cart</button>
      </div>
  </div>
</div>


<script>
let selectedSize = null;
let selectedColor = null;

// ------------------------------
// ðŸ”„ Update UI & call Django API
// ------------------------------
function updateVariant() {
    const url = `/api/product/{{ product.id }}/filter/?size=${selectedSize || ""}&color=${selectedColor || ""}`;

    fetch(url)
        .then(res => res.json())
        .then(data => {

            // â­ Update SIZE buttons
            document.querySelectorAll(".size-btn").forEach(btn => {
                const val = btn.dataset.size;
                btn.disabled = !data.sizes.includes(val);
                btn.classList.toggle("active-btn", val === selectedSize);
            });

            // â­ Update COLOR buttons
            document.querySelectorAll(".color-btn").forEach(btn => {
                const val = btn.dataset.color;
                btn.disabled = !data.colors.includes(val);
                btn.classList.toggle("active-btn", val === selectedColor);
            });

            // â­ Update image and price
            if (data.image) document.getElementById("variant-image").src = data.image;
            //if (data.price) document.getElementById("variant-price").innerText = "$" + data.price;
        });
}

// ------------------------------
// ðŸŽ¯ handle size click
// ------------------------------
document.querySelectorAll(".size-btn").forEach(btn => {
    btn.addEventListener("click", function () {
        const clicked = this.dataset.size;

        // ðŸ‘‰ Clicking the SAME size clears filter
        if (selectedSize === clicked) {
            selectedSize = null;
        } else {
            selectedSize = clicked;
        }

        updateVariant();
    });
});

// ------------------------------
// ðŸŽ¯ handle color click
// ------------------------------
document.querySelectorAll(".color-btn").forEach(btn => {
    btn.addEventListener("click", function () {
        const clicked = this.dataset.color;

        // ðŸ‘‰ Clicking the SAME color clears filter
        if (selectedColor === clicked) {
            selectedColor = null;
        } else {
            selectedColor = clicked;
        }

        updateVariant();
    });
});
</script>


<!-- â­ Custom highlight class -->
<style>
.active-btn {
    background-color: #0d6efd !important;
    color: white !important;
    border-color: #0d6efd !important;
}
</style>

{% endblock %}
