{% extends "base.html" %}
{% load static %}
{% block content %}

<div class="container my-5">

    <div class="row g-4">

        <!-- Left: Product Image -->
        <div class="col-12 col-md-5 text-center">
            {% if product.first_image_url %}
                <img src="{{ product.first_image_url }}" class="img-fluid rounded shadow-sm"
                     style="max-height: 380px; object-fit: contain;">
            {% else %}
                <img src="{% static 'shop/no-image.png' %}" class="img-fluid rounded shadow-sm"
                     style="max-height: 380px; object-fit: contain;">
            {% endif %}
        </div>

        <!-- Right: Product Info -->
        <div class="col-12 col-md-7">

            <div class="d-flex justify-content-between align-items-start">
                <h3 class="fw-bold">{{ product.name }}</h3>

                {% if user.is_authenticated %}
                <a href="{% url 'shop:toggle_favorite' product.id %}"
                   class="fs-3 text-decoration-none">
                    {% if is_favorite %}‚ù§Ô∏è{% else %}ü§ç{% endif %}
                </a>
                {% endif %}
            </div>

            <hr>

            <!-- Price Section -->
            <div class="mb-3">
                {% if product.discount > 0 %}
                    <span class="text-danger fw-bold fs-3">{{ product.selling_price }} EGP</span>
                    <span class="text-muted text-decoration-line-through fs-5">{{ product.purchase_price }} EGP</span>
                {% else %}
                    <span class="fw-bold fs-3">{{ product.selling_price }} EGP</span>
                {% endif %}
            </div>

            <!-- Description -->
            {% if product.description %}
            <p class="text-muted">{{ product.description }}</p>
            {% endif %}

            <!-- Variants -->
            <h5 class="fw-bold mt-4">Available Options</h5>
            <form method="get" class="mb-4">

                <div class="row g-3">

                    <!-- Size -->
                    <div class="col-6">
                        <label class="form-label fw-bold">Size</label>
                        <select id="sizeSelect" class="form-select">
                            {% for v in variants %}
                                <option value="{{ v.id }}" data-color="{{ v.color }}">
                                    {{ v.size }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Color -->
                    <div class="col-6">
                        <label class="form-label fw-bold">Color</label>
                        <select id="colorSelect" class="form-select">
                            {% for v in variants %}
                                <option value="{{ v.id }}" data-size="{{ v.size }}">
                                    {{ v.color }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                </div>

            </form>

            <!-- Availability -->
            <p class="fw-bold">Availability:
                <span class="text-success">{{ current_variant.availability_count }}</span>
            </p>

            <!-- Cart Toggle Button -->
            {% if user.is_authenticated %}

                {% if in_cart %}
                <a href="{% url 'shop:toggle_cart' current_variant.id %}"
                   class="btn btn-danger btn-lg w-100 mt-3">
                    Remove from cart ‚ùå
                </a>
                {% else %}
                <a href="{% url 'shop:toggle_cart' current_variant.id %}"
                   class="btn btn-primary btn-lg w-100 mt-3">
                    Add to cart üõí
                </a>
                {% endif %}

            {% else %}
            <a href="{% url 'shop:login' %}" class="btn btn-outline-secondary btn-lg w-100 mt-3">
                Login to Buy
            </a>
            {% endif %}

        </div>

    </div>

</div>

<script>
// Optional: Auto-update color when selecting size and vice versa
</script>

{% endblock %}
