<!DOCTYPE html>
<html>
<head>
    <title>Fast Product Creation</title>
    <style>
        .variant-row { margin-bottom: 8px; display: flex; gap: 10px; }
        .variant-list { margin-top: 15px; border: 1px solid #ccc; padding: 10px; }
    </style>
</head>
<body>

<h2>Fast Add Product</h2>

{% if error %}
<p style="color:red">{{ error }}</p>
{% endif %}

<form method="POST" enctype="multipart/form-data">
    {% csrf_token %}

    <h3>Product Information</h3>

    <label>Name:</label>
    <input type="text" name="name" required><br>

    <label>Category:</label>
    <input type="text" name="category" required><br>

    <label>Purchase Price:</label>
    <input type="number" step="0.01" name="purchase_price" required><br>

    <label>Selling Price:</label>
    <input type="number" step="0.01" name="selling_price" required><br>

    <label>Discount (%):</label>
    <input type="number" step="0.01" name="discount"><br>

    <label>Description:</label><br>
    <textarea name="description"></textarea><br>

    <label>Size Type:</label>
    <select name="size_type" id="sizeTypeSelect" required>
        <option value="">--Choose--</option>
        {% for s in size_types %}
            <option value="{{ s.id }}" data-sizes="{{ s.sizes }}">{{ s.name }}</option>
        {% endfor %}
    </select>

    <hr><h3>Variants</h3>

    <div class="variant-row">
        <select id="sizeSelect">
            <option value="">Select size type first</option>
        </select>

        <input type="text" id="colorInput" placeholder="Color">
        <input type="number" id="quantityInput" placeholder="Qty">

        <button type="button" onclick="addVariant()">Add</button>
    </div>

    <div class="variant-list" id="variantsContainer"></div>

    <hr><h3>Images</h3>
    <input type="file" name="images" multiple>

    <br><br>
    <button type="submit">Save Product</button>
</form>

<script>
    const sizeTypeSelect = document.getElementById("sizeTypeSelect");
    const sizeSelect = document.getElementById("sizeSelect");
    const container = document.getElementById("variantsContainer");

    sizeTypeSelect.addEventListener("change", function () {
        sizeSelect.innerHTML = "";
        const sizes = JSON.parse(this.selectedOptions[0].dataset.sizes);

        sizes.forEach(size => {
            let opt = document.createElement("option");
            opt.value = size;
            opt.textContent = size;
            sizeSelect.appendChild(opt);
        });
    });

    function addVariant() {
        const size = sizeSelect.value;
        const color = document.getElementById("colorInput").value;
        const qty = document.getElementById("quantityInput").value;

        if (!size || !color || !qty) {
            alert("Fill all fields");
            return;
        }

        const row = document.createElement("div");
        row.innerHTML = `
            <p>
                Size: ${size}, Color: ${color}, Qty: ${qty}
                <input type="hidden" name="variant_size[]" value="${size}">
                <input type="hidden" name="variant_color[]" value="${color}">
                <input type="hidden" name="variant_quantity[]" value="${qty}">
                <button type="button" onclick="this.parentElement.remove()">X</button>
            </p>
        `;

        container.appendChild(row);
    }
</script>

</body>
</html>
